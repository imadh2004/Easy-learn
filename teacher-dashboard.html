<!DOCTYPE html>
<html>
<head>
<title>Teacher Dashboard</title>
<style>
body{font-family:Arial;background:#f4f6f8;padding:20px}
.student{background:#fff;padding:15px;margin:10px 0;border-radius:8px}
</style>
</head>
<body>

<h2>Teacher Dashboard</h2>
<button onclick="location.href='leaderboard.html'">Leaderboard</button>
<button onclick="logout()">Logout</button>
<button onclick="location.href='create-exam.html'">âž• Create Exam</button>
<div id="students">Loading students...</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth,onAuthStateChanged,signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getFirestore,doc,getDoc,collection,getDocs,updateDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig={
  apiKey:"AIzaSyACtMRuTNPVqk15KUebcCccrqESv9hFEgE",
  authDomain:"science-cls.firebaseapp.com",
  projectId:"science-cls",
  appId:"1:778012932104:web:f997ad31edac581f0b79bd"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

onAuthStateChanged(auth,async user=>{
  if(!user){location.href="index.html";return;}

  const teacherSnap=await getDoc(doc(db,"teachers",user.uid));
  if(!teacherSnap.exists()){
    alert("Teacher access only");
    location.href="index.html";
    return;
  }

  loadStudents();
});

async function loadStudents(){
  const div=document.getElementById("students");
  div.innerHTML="";

  const snap=await getDocs(collection(db,"students"));
  snap.forEach(s=>{
    const d=s.data();
    const el=document.createElement("div");
    el.className="student";
    el.innerHTML=`
      <b>${d.name}</b> (${d.index})<br>
      Attempts: ${JSON.stringify(d.attempts||{})}
      <br><button onclick="reset('${s.id}')">Reset Attempts</button>
    `;
    div.appendChild(el);
  });
}

window.reset=async uid=>{
  await updateDoc(doc(db,"students",uid),{attempts:{}});
  alert("Reset done");
  loadStudents();
};

window.logout=()=>signOut(auth).then(()=>location.href="index.html");
</script>
</body>
</html>
