<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Teacher Dashboard</title>
<style>
body {
  font-family: Arial;
  background:#f4f6f8;
  padding:20px;
}
section {
  background:white;
  padding:15px;
  margin-bottom:20px;
  border-radius:10px;
}
input, button {
  padding:8px;
  margin:5px 0;
  width:250px;
}
button { cursor:pointer; }
h2, h3 { margin-top:0; }
</style>
</head>
<body>

<h2>Teacher Dashboard</h2>

<!-- ================= STUDENT REGISTRATION ================= -->
<section>
<h3>Add Student</h3>

<input id="studentName" placeholder="Name with initials (A.B. Perera)">
<input id="studentIndex" placeholder="Index Number (numbers only)">
<input id="studentPassword" type="password" placeholder="Password">
<br>
<button onclick="addStudent()">Add Student</button>

<p id="studentMsg"></p>
</section>

<!-- ================= EXAM CREATION ================= -->
<section>
<h3>Create Exam</h3>

<input id="examTitle" placeholder="Exam Title">
<input id="examDuration" type="number" placeholder="Duration (minutes)">
<br>
<button onclick="createExam()">Create Exam</button>

<p id="examMsg"></p>
</section>

<button onclick="logout()">Logout</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { 
  getAuth, onAuthStateChanged, signOut,
  createUserWithEmailAndPassword
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { 
  getFirestore, doc, setDoc, collection, addDoc, getDoc 
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

/* ---------- Firebase Config ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyACtMRuTNPVqk15KUebcCccrqESv9hFEgE",
  authDomain: "science-cls.firebaseapp.com",
  projectId: "science-cls",
  storageBucket: "science-cls.appspot.com",
  messagingSenderId: "778012932104",
  appId: "1:778012932104:web:f997ad31edac581f0b79bd"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ---------- Role Check ---------- */
onAuthStateChanged(auth, async (user)=>{
  if(!user){
    window.location.href="index.html";
    return;
  }
  const snap = await getDoc(doc(db,"teachers",user.uid));
  if(!snap.exists()){
    alert("Access denied");
    signOut(auth);
  }
});

/* ---------- Add Student ---------- */
window.addStudent = async ()=>{
  const name = studentName.value.trim();
  const index = studentIndex.value.trim();
  const password = studentPassword.value;

  if(!name || !index || !password){
    studentMsg.innerText="Fill all fields";
    return;
  }

  const email = `easylearn${index}@example.com`;

  try{
    const cred = await createUserWithEmailAndPassword(auth,email,password);

    await setDoc(doc(db,"students",cred.user.uid),{
      name,
      index,
      email,
      role:"student",
      createdAt:new Date()
    });

    studentMsg.innerText = "Student added successfully";
    studentName.value="";
    studentIndex.value="";
    studentPassword.value="";
  }
  catch(err){
    studentMsg.innerText = err.message;
  }
};

/* ---------- Create Exam ---------- */
window.createExam = async ()=>{
  const title = examTitle.value.trim();
  const duration = examDuration.value;

  if(!title || !duration){
    examMsg.innerText="Fill all fields";
    return;
  }

  await addDoc(collection(db,"exams"),{
    title,
    duration:Number(duration),
    isActive:true,
    createdAt:new Date()
  });

  examMsg.innerText="Exam created";
  examTitle.value="";
  examDuration.value="";
};

/* ---------- Logout ---------- */
window.logout = ()=>{
  signOut(auth).then(()=>window.location.href="index.html");
};
</script>

</body>
</html>
