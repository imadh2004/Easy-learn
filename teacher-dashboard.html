<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Teacher Dashboard</title>
<style>
  body { font-family: Arial; background:#f4f6f8; padding:20px; }
  h2, h3, h4 { text-align:center; }
  input, button { padding:8px; margin:5px; }
  #studentList div, #examsList div, .questionDiv {
    background:white;
    padding:10px;
    margin:5px;
    border-radius:5px;
    box-shadow:0 1px 5px rgba(0,0,0,0.1);
  }
</style>
</head>
<body>

<h2>Teacher Dashboard</h2>

<!-- EXAM CREATION -->
<h3>Create Exam</h3>
<input type="text" id="examTitle" placeholder="Exam Title"><br>
<input type="number" id="examDuration" placeholder="Duration (minutes)"><br>

<div id="questionsContainer">
  <h4>Questions</h4>
  <div class="questionDiv">
    <input type="text" class="questionText" placeholder="Question"><br>
    <input type="text" class="option1" placeholder="Option A">
    <input type="text" class="option2" placeholder="Option B">
    <input type="text" class="option3" placeholder="Option C">
    <input type="text" class="option4" placeholder="Option D">
    <select class="answerSelect">
      <option value="0">A</option>
      <option value="1">B</option>
      <option value="2">C</option>
      <option value="3">D</option>
    </select>
  </div>
</div>

<button onclick="addQuestion()">Add Another Question</button><br>
<button onclick="createExam()">Create Exam</button>

<h4>Current Exams</h4>
<div id="examsList">Loading exams...</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore, collection, getDocs, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"AIzaSyACtMRuTNPVqk15KUebcCccrqESv9hFEgE",
  authDomain:"science-cls.firebaseapp.com",
  projectId:"science-cls",
  storageBucket:"science-cls.appspot.com",
  messagingSenderId:"778012932104",
  appId:"1:778012932104:web:f997ad31edac581f0b79bd"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const examsDiv = document.getElementById("examsList");
const questionsContainer = document.getElementById("questionsContainer");

/* ---------- ADD QUESTION ---------- */
function addQuestion() {
  const div = document.createElement("div");
  div.className = "questionDiv";
  div.innerHTML = `
    <input type="text" class="questionText" placeholder="Question"><br>
    <input type="text" class="option1" placeholder="Option A">
    <input type="text" class="option2" placeholder="Option B">
    <input type="text" class="option3" placeholder="Option C">
    <input type="text" class="option4" placeholder="Option D">
    <select class="answerSelect">
      <option value="0">A</option>
      <option value="1">B</option>
      <option value="2">C</option>
      <option value="3">D</option>
    </select>
  `;
  questionsContainer.appendChild(div);
}

/* ---------- CREATE EXAM (FIXED) ---------- */
async function createExam(){
  const title = document.getElementById("examTitle").value.trim();
  const duration = Number(document.getElementById("examDuration").value);

  if(!title || !duration){
    alert("Enter exam title and duration");
    return;
  }

  const questionDivs = document.querySelectorAll(".questionDiv");
  const questions = [];

  questionDivs.forEach(div=>{
    const q = div.querySelector(".questionText").value.trim();
    const options = [
      div.querySelector(".option1").value.trim(),
      div.querySelector(".option2").value.trim(),
      div.querySelector(".option3").value.trim(),
      div.querySelector(".option4").value.trim()
    ];
    const answer = Number(div.querySelector(".answerSelect").value);

    if(q && options.every(o=>o)){
      questions.push({ q, options, answer });
    }
  });

  if(questions.length === 0){
    alert("Add at least one valid question");
    return;
  }

  await setDoc(doc(collection(db,"exams")), {
    title,
    duration,
    questions,
    active:false,
    createdAt: Date.now()
  });

  alert("Exam created successfully");

  document.getElementById("examTitle").value = "";
  document.getElementById("examDuration").value = "";

  questionsContainer.innerHTML = `
    <h4>Questions</h4>
    <div class="questionDiv">
      <input type="text" class="questionText" placeholder="Question"><br>
      <input type="text" class="option1" placeholder="Option A">
      <input type="text" class="option2" placeholder="Option B">
      <input type="text" class="option3" placeholder="Option C">
      <input type="text" class="option4" placeholder="Option D">
      <select class="answerSelect">
        <option value="0">A</option>
        <option value="1">B</option>
        <option value="2">C</option>
        <option value="3">D</option>
      </select>
    </div>
  `;

  loadExams();
}

/* ---------- LOAD EXAMS ---------- */
async function loadExams(){
  examsDiv.innerHTML = "";
  const snap = await getDocs(collection(db,"exams"));
  snap.forEach(docSnap=>{
    const d = docSnap.data();
    const div = document.createElement("div");
    div.textContent = `${d.title} (${d.duration} min)`;
    examsDiv.appendChild(div);
  });
}

loadExams();

/* ðŸ”‘ THIS IS THE ACTUAL FIX */
window.addQuestion = addQuestion;
window.createExam = createExam;

</script>
</body>
</html>
