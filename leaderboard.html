<!DOCTYPE html>
<html>
<head>
<title>Leaderboard</title>
<style>
body{font-family:Arial;background:#f4f6f8;padding:20px}
table{width:100%;background:#fff;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:10px;text-align:center}
th{background:#007bff;color:white}
</style>
</head>
<body>

<h2>Leaderboard</h2>
<select id="examSelect"></select>

<table>
<thead><tr><th>Rank</th><th>Name</th><th>Score</th></tr></thead>
<tbody id="rows"></tbody>
</table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore,collection,getDocs } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig={
  apiKey:"AIzaSyACtMRuTNPVqk15KUebcCccrqESv9hFEgE",
  authDomain:"science-cls.firebaseapp.com",
  projectId:"science-cls",
  appId:"1:778012932104:web:f997ad31edac581f0b79bd"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

const examSelect=document.getElementById("examSelect");
const rows=document.getElementById("rows");

const examsSnap=await getDocs(collection(db,"exams"));
examsSnap.forEach(e=>{
  examSelect.innerHTML+=`<option value="${e.id}">${e.data().title}</option>`;
});

examSelect.onchange=load;

async function load(){
  rows.innerHTML="";
  const examId=examSelect.value;
  let list=[];

  const students=await getDocs(collection(db,"students"));
  students.forEach(s=>{
    const d=s.data();
    list.push({name:d.name,score:d.attempts?.[examId]||0});
  });

  list.sort((a,b)=>b.score-a.score);
  list.forEach((s,i)=>{
    rows.innerHTML+=`<tr><td>${i+1}</td><td>${s.name}</td><td>${s.score}</td></tr>`;
  });
}
</script>
</body>
</html>
