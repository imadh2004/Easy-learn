<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Exams</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4f6f8;
    margin: 0;
    padding: 20px;
  }

  h1 {
    text-align: center;
    margin-bottom: 20px;
  }

  .exam-list {
    max-width: 700px;
    margin: auto;
  }

  .exam-card {
    background: white;
    padding: 15px;
    margin-bottom: 12px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .exam-card.disabled {
    opacity: 0.5;
  }

  .exam-title {
    font-size: 16px;
    font-weight: bold;
  }

  button {
    padding: 8px 14px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }

  .start-btn {
    background: #007bff;
    color: white;
  }

  .disabled-btn {
    background: #aaa;
    color: white;
    cursor: not-allowed;
  }
</style>
</head>

<body>

<h1>Available Exams</h1>

<div class="exam-list" id="examList"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
  import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyACtMRuTNPVqk15KUebcCccrqESv9hFEgE",
    authDomain: "science-cls.firebaseapp.com",
    projectId: "science-cls",
    storageBucket: "science-cls.appspot.com",
    messagingSenderId: "778012932104",
    appId: "1:778012932104:web:f997ad31edac581f0b79bd"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const examList = document.getElementById("examList");

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "index.html";
      return;
    }

    // Fetch student data (attempts)
    const studentRef = doc(db, "students", user.uid);
    const studentSnap = await getDoc(studentRef);
    const attempts = studentSnap.exists() ? (studentSnap.data().attempts || {}) : {};

    // Fetch exams
    const examsSnap = await getDocs(collection(db, "exams"));

    examList.innerHTML = "";

    examsSnap.forEach(examDoc => {
      const exam = examDoc.data();

      // Show ONLY active exams
      if (!exam.active) return;

      const attempted = attempts[examDoc.id];

      const card = document.createElement("div");
      card.className = "exam-card" + (attempted ? " disabled" : "");

      const title = document.createElement("div");
      title.className = "exam-title";
      title.textContent = exam.title;

      const btn = document.createElement("button");

      if (attempted) {
        btn.textContent = "Attempted";
        btn.className = "disabled-btn";
        btn.disabled = true;
      } else {
        btn.textContent = "Start Exam";
        btn.className = "start-btn";
        btn.onclick = () => {
          window.location.href = `exam.html?examId=${examDoc.id}`;
        };
      }

      card.appendChild(title);
      card.appendChild(btn);
      examList.appendChild(card);
    });
  });
</script>

</body>
</html>
